@page
@model YouView.Pages.SearchModel
@{
    ViewData["Title"] = "Search Results";
}

<style>
    .nav-tabs .nav-link {
        color: #606060;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 600;
        padding: 10px 20px;
        margin-right: 15px;
    }
    
    .nav-tabs .nav-link:hover {
        color: #0f0f0f;
        background: transparent;
    }
    
    .nav-tabs .nav-link.active {
        color: #0f0f0f;
        background: transparent;
        border-bottom: 3px solid #0f0f0f; 
    }

    
    .creator-card {
        transition: background-color 0.2s;
    }
    .creator-card:hover {
        background-color: #f9f9f9;
    }
    .creator-avatar-large {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
    }
    .creator-placeholder-large {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: #2C2C2C;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
    }
</style>

<div class="container mt-4 mb-5">
    
    <div class="d-flex align-items-center mb-4">
        <h3 class="me-3">Results for: <span class="text-primary">"@Model.Q"</span></h3>
    </div>

    <ul class="nav nav-tabs mb-4" id="searchTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="videos-tab" data-bs-toggle="tab" data-bs-target="#videos" type="button" role="tab">
                Videos <span class="badge bg-secondary opacity-50 ms-1 rounded-pill">@Model.VideoResults.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="creators-tab" data-bs-toggle="tab" data-bs-target="#creators" type="button" role="tab">
                Creators <span class="badge bg-secondary opacity-50 ms-1 rounded-pill">@Model.CreatorResults.Count</span>
            </button>
        </li>
    </ul>

    <div class="tab-content" id="searchTabsContent">
        
        <div class="tab-pane fade show active" id="videos" role="tabpanel" tabindex="0">
            @if (Model.VideoResults.Any())
            {
                <div class="row g-4">
                    @foreach (var video in Model.VideoResults)
                    {
                        <div class="col-12 col-md-6 col-lg-4">
                            <a asp-page="/Watch" asp-route-id="@video.VideoId" class="video-card shadow-sm text-decoration-none">
                                
                                <div class="thumbnail-container mb-2" style="position: relative; border-radius: 12px; overflow: hidden; background: #000; padding-top: 56.25%;">
                                    <img src="@(string.IsNullOrEmpty(video.ThumbnailUrl) ? "https://placehold.co/600x400/1F1F1F/white?text=No+Thumbnail" : video.ThumbnailUrl)" 
                                         class="thumbnail-img" 
                                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;" />

                                    @if (!string.IsNullOrEmpty(video.Duration))
                                    {
                                        <span class="badge bg-dark position-absolute bottom-0 end-0 m-2 opacity-75">@video.Duration</span>
                                    }
                                </div>
                                
                                <div class="d-flex align-items-start mb-2 px-1">
                                    <div class="video-title fw-bold text-dark" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                        @video.Title
                                    </div>
                                </div>

                                <div class="author-info px-1 d-flex align-items-center gap-2 text-muted small">
                                    <img src="@(string.IsNullOrEmpty(video.User?.ProfilePicUrl) ? "https://ui-avatars.com/api/?name=" + (video.User?.UserName ?? "U") : video.User.ProfilePicUrl)" 
                                         style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />
                                    
                                    <span>@(video.User?.UserName ?? "Unknown")</span>
                                    <span class="ms-auto local-date" data-utc="@video.CreatedAt.ToString("o")">
                                        @video.CreatedAt.ToString("MMM dd")
                                    </span>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <h5 class="text-muted">No videos found matching this search.</h5>
                </div>
            }
        </div>

        <div class="tab-pane fade" id="creators" role="tabpanel" tabindex="0">
            @if (Model.CreatorResults.Any())
            {
                <div class="d-flex flex-column gap-3">
                    @foreach (var user in Model.CreatorResults)
                    {
                        <a asp-page="/Channel" asp-route-username="@user.UserName" class="text-decoration-none text-dark">
                            <div class="d-flex align-items-center p-3 border rounded-4 creator-card bg-white shadow-sm">
                                
                                <div class="me-4">
                                    @if (!string.IsNullOrEmpty(user.ProfilePicUrl))
                                    {
                                        <img src="@user.ProfilePicUrl" class="creator-avatar-large shadow-sm" />
                                    }
                                    else
                                    {
                                        <div class="creator-placeholder-large shadow-sm">
                                            @(user.UserName?.Substring(0, 1).ToUpper() ?? "U")
                                        </div>
                                    }
                                </div>
                                
                                <div>
                                    <h4 class="fw-bold mb-1">@user.UserName</h4>
                                    <div class="text-muted small">
                                        @if(user.Followers != null) {
                                            <span>@user.Followers.Count subscribers</span>
                                        } else {
                                            <span>Channel</span>
                                        }
                                    </div>
                                    <p class="text-muted small mt-2 mb-0" style="max-width: 600px;">
                                        @(string.IsNullOrEmpty(user.Bio) ? "" : (user.Bio.Length > 100 ? user.Bio.Substring(0, 100) + "..." : user.Bio))
                                    </p>
                                </div>
                                
                                <div class="ms-auto">
                                    <button class="btn btn-dark rounded-pill px-4">View Channel</button>
                                </div>
                            </div>
                        </a>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <h5 class="text-muted">No creators found matching this search.</h5>
                </div>
            }
        </div>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const dates = document.querySelectorAll('.local-date');
        dates.forEach(span => {
            const utcTime = span.getAttribute('data-utc');
            if (utcTime) {
                const date = new Date(utcTime);
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                span.textContent = date.toLocaleDateString(undefined, options);
            }
        });
    });
</script>